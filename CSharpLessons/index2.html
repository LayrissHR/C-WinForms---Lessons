<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Практическо Задание: Списък със Задачи</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .step-number {
            background-color: #4f46e5;
            color: white;
            min-width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1rem;
            margin-right: 12px;
        }
        .code-block {
            background-color: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            position: relative;
            overflow-x: auto;
            margin-top: 1rem;
        }
        .code-block pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .code-block .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #334155;
            color: #cbd5e1;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .code-block .copy-btn:hover {
            background-color: #475569;
        }
        .code-comment { color: #94a3b8; }
        .code-keyword { color: #818cf8; }
        .code-type { color: #34d399; }
        .code-string { color: #f87171; }
        h2 {
            font-size: 1.875rem;
            font-weight: 700;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 2rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
        }
        li {
            margin-bottom: 0.75rem;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <header class="bg-white shadow">
        <div class="container mx-auto px-6 py-5">
            <h1 class="text-3xl font-bold text-indigo-600">Практическо Задание: Създаване на "Списък със задачи"</h1>
            <p class="text-slate-600 mt-1">Прилагане на трислойна архитектура в C# и WinForms.</p>
        </div>
    </header>

    <main class="container mx-auto px-6 py-10">

        <!-- Part 1 -->
        <section class="mb-12">
            <h2>Част 1: Подготовка на проекта</h2>
            <p class="mb-6">Първо, трябва да създадем основата на нашето приложение и да подготвим папките за трите слоя.</p>
            
            <h3><span class="step-number">1</span>Създайте нов проект</h3>
            <ul class="list-inside list-disc ml-4">
                <li>Отворете Visual Studio.</li>
                <li>Изберете <strong>Create a new project</strong>.</li>
                <li>В търсачката напишете <code>Windows Forms App (.NET Framework)</code> и го изберете. Натиснете <strong>Next</strong>.</li>
                <li>За <strong>Project name</strong> напишете <code>ToDoApp</code>.</li>
                <li>Натиснете <strong>Create</strong>.</li>
            </ul>
             <img src="https://placehold.co/800x450/e0e7ff/4f46e5?text=Visual+Studio%0A%D0%9D%D0%BE%D0%B2+%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82" alt="Visual Studio new project window" class="mt-4 rounded-lg shadow-md border">

            <h3><span class="step-number">2</span>Създайте папки за слоевете</h3>
            <ul class="list-inside list-disc ml-4">
                <li>В прозореца <strong>Solution Explorer</strong> (обикновено вдясно), кликнете с десен бутон върху името на проекта (`ToDoApp`).</li>
                <li>Изберете <strong>Add -> New Folder</strong>. Назовете папката <code>Models</code>.</li>
                <li>Повторете, за да създадете папки <code>DataAccessLayer</code> и <code>Services</code>.</li>
            </ul>
            <p class="mt-4 p-4 bg-indigo-50 border-l-4 border-indigo-400 rounded-r-lg text-sm">
                <strong>Защо правим това?</strong> Още от самото начало въвеждаме ред. Всеки файл, който създаваме, ще отиде в правилната папка според ролята, която изпълнява.
            </p>
        </section>

        <!-- Part 2 -->
        <section class="mb-12">
            <h2>Част 2: Data Access Layer ("Склад")</h2>
            <p class="mb-6">Започваме от най-долния слой. Той ще отговаря единствено за съхранението и достъпа до нашите задачи.</p>

            <h3><span class="step-number">1</span>Създайте Модела (етикета на данните)</h3>
            <ul class="list-inside list-disc ml-4">
                <li>Кликнете с десен бутон върху папката <code>Models</code> -> <strong>Add -> Class...</strong></li>
                <li>Назовете класа <code>TaskItem.cs</code> и натиснете <strong>Add</strong>.</li>
                <li>Вътре в класа напишете следния код:</li>
            </ul>
            <div class="code-block">
                <button class="copy-btn">Копирай</button>
                <pre><code><span class="code-comment">// Файл: Models/TaskItem.cs</span>
<span class="code-keyword">public class</span> <span class="code-type">TaskItem</span>
{
    <span class="code-comment">// Свойство, което ще съдържа текста на задачата</span>
    <span class="code-keyword">public string</span> Description { <span class="code-keyword">get</span>; <span class="code-keyword">set</span>; }

    <span class="code-comment">// Свойство, което показва дали задачата е изпълнена</span>
    <span class="code-keyword">public bool</span> IsDone { <span class="code-keyword">get</span>; <span class="code-keyword">set</span>; }
}</code></pre>
            </div>
            <p class="mt-4 text-sm text-slate-600"><strong>Обяснение:</strong> Този клас е просто <strong>чертеж</strong>. Той описва как изглежда една задача в нашето приложение.</p>

            <h3><span class="step-number">2</span>Създайте Репозиторито ("склададжията")</h3>
             <ul class="list-inside list-disc ml-4">
                <li>Кликнете с десен бутон върху папката <code>DataAccessLayer</code> -> <strong>Add -> Class...</strong></li>
                <li>Назовете класа <code>TaskRepository.cs</code> и натиснете <strong>Add</strong>.</li>
            </ul>
            <div class="code-block">
                <button class="copy-btn">Копирай</button>
                <pre><code><span class="code-comment">// Файл: DataAccessLayer/TaskRepository.cs</span>
<span class="code-keyword">using</span> System.Collections.Generic; <span class="code-comment">// Трябва ни, за да използваме List&lt;&gt;</span>
<span class="code-keyword">using</span> ToDoApp.Models; <span class="code-comment">// Трябва ни, за да използваме класа TaskItem</span>

<span class="code-keyword">public class</span> <span class="code-type">TaskRepository</span>
{
    <span class="code-comment">// Това е нашият "фалшив" склад - статичен списък.</span>
    <span class="code-keyword">private static readonly</span> List&lt;<span class="code-type">TaskItem</span>&gt; _tasks = <span class="code-keyword">new</span> List&lt;<span class="code-type">TaskItem</span>&gt;();

    <span class="code-keyword">public</span> List&lt;<span class="code-type">TaskItem</span>&gt; GetAllTasks()
    {
        <span class="code-keyword">return</span> _tasks;
    }

    <span class="code-keyword">public void</span> AddTask(<span class="code-type">TaskItem</span> task)
    {
        _tasks.Add(task);
    }
}</code></pre>
            </div>
             <p class="mt-4 text-sm text-slate-600"><strong>Обяснение:</strong> Този клас има две прости отговорности: да добавя задачи в списъка и да връща целия списък. Той не прави проверки или валидации.</p>
        </section>

        <!-- Part 3 -->
        <section class="mb-12">
            <h2>Част 3: Service Layer ("Мозъкът")</h2>
             <p class="mb-6">Този слой ще съдържа "правилата" на нашето приложение и ще координира работата между интерфейса и склада.</p>
             <h3><span class="step-number">1</span>Създайте Сървиса ("готвача")</h3>
             <ul class="list-inside list-disc ml-4">
                <li>Кликнете с десен бутон върху папката <code>Services</code> -> <strong>Add -> Class...</strong></li>
                <li>Назовете класа <code>TaskService.cs</code> и натиснете <strong>Add</strong>.</li>
            </ul>
            <div class="code-block">
                <button class="copy-btn">Копирай</button>
                <pre><code><span class="code-comment">// Файл: Services/TaskService.cs</span>
<span class="code-keyword">using</span> System;
<span class="code-keyword">using</span> System.Collections.Generic;
<span class="code-keyword">using</span> ToDoApp.DataAccessLayer;
<span class="code-keyword">using</span> ToDoApp.Models;

<span class="code-keyword">public class</span> <span class="code-type">TaskService</span>
{
    <span class="code-keyword">private readonly</span> <span class="code-type">TaskRepository</span> _taskRepository = <span class="code-keyword">new</span> <span class="code-type">TaskRepository</span>();

    <span class="code-keyword">public</span> List&lt;<span class="code-type">TaskItem</span>&gt; GetAllTasks()
    {
        <span class="code-keyword">return</span> _taskRepository.GetAllTasks();
    }

    <span class="code-keyword">public void</span> AddNewTask(<span class="code-keyword">string</span> description)
    {
        <span class="code-keyword">if</span> (<span class="code-type">string</span>.IsNullOrWhiteSpace(description))
        {
            <span class="code-keyword">throw new</span> <span class="code-type">Exception</span>(<span class="code-string">"Описанието на задачата не може да бъде празно!"</span>);
        }

        <span class="code-keyword">var</span> newTask = <span class="code-keyword">new</span> <span class="code-type">TaskItem</span>
        {
            Description = description,
            IsDone = <span class="code-keyword">false</span>
        };
        _taskRepository.AddTask(newTask);
    }

    <span class="code-keyword">public void</span> ToggleTaskStatus(<span class="code-keyword">int</span> taskIndex)
    {
        <span class="code-keyword">var</span> allTasks = _taskRepository.GetAllTasks();
        <span class="code-keyword">if</span> (taskIndex >= 0 && taskIndex < allTasks.Count)
        {
            allTasks[taskIndex].IsDone = !allTasks[taskIndex].IsDone;
        }
    }
}</code></pre>
            </div>
             <p class="mt-4 text-sm text-slate-600"><strong>Обяснение:</strong> Забележете как този клас съдържа <strong>правилата</strong> (задачата не може да е празна). Той е посредникът между интерфейса и данните.</p>
        </section>

        <!-- Part 4 -->
        <section class="mb-12">
            <h2>Част 4: Presentation Layer (Интерфейс)</h2>
            <p class="mb-6">Време е да накараме нашето приложение да изглежда добре и да работи.</p>
             <h3><span class="step-number">1</span>Дизайн на формата</h3>
             <ul class="list-inside list-disc ml-4">
                <li>Отворете <code>Form1.cs</code> в режим на дизайн.</li>
                <li>От **Toolbox** плъзнете **TextBox**, **Button** и **CheckedListBox**.</li>
                <li>В **Properties** прозореца задайте следните <strong>(Name)</strong> свойства:
                    <ul>
                        <li><code>txtNewTask</code> за TextBox</li>
                        <li><code>btnAdd</code> за Button (и `Text` на `Добави`)</li>
                        <li><code>clbTasks</code> за CheckedListBox</li>
                    </ul>
                </li>
             </ul>
             <img src="https://placehold.co/800x300/e0e7ff/4f46e5?text=WinForms+%D0%B4%D0%B8%D0%B7%D0%B0%D0%B9%D0%BD" alt="Simple WinForms layout" class="mt-4 rounded-lg shadow-md border">

             <h3><span class="step-number">2</span>Напишете кода зад формата ("сервитьора")</h3>
             <ul class="list-inside list-disc ml-4">
                <li>Кликнете два пъти върху бутона "Добави", за да се генерира `btnAdd_Click` събитието.</li>
                <li>Отворете `Form1.cs` в режим на код и го заменете със следния:</li>
             </ul>
             <div class="code-block">
                <button class="copy-btn">Копирай</button>
                <pre><code><span class="code-comment">// Файл: Form1.cs</span>
<span class="code-keyword">using</span> System;
<span class="code-keyword">using</span> System.Windows.Forms;
<span class="code-keyword">using</span> ToDoApp.Services;

<span class="code-keyword">public partial class</span> <span class="code-type">Form1</span> : <span class="code-type">Form</span>
{
    <span class="code-keyword">private readonly</span> <span class="code-type">TaskService</span> _taskService = <span class="code-keyword">new</span> <span class="code-type">TaskService</span>();

    <span class="code-keyword">public</span> Form1()
    {
        InitializeComponent();
        RefreshTaskList();
    }

    <span class="code-keyword">private void</span> btnAdd_Click(<span class="code-type">object</span> sender, <span class="code-type">EventArgs</span> e)
    {
        <span class="code-keyword">try</span>
        {
            _taskService.AddNewTask(txtNewTask.Text);
            txtNewTask.Clear();
            RefreshTaskList();
        }
        <span class="code-keyword">catch</span> (<span class="code-type">Exception</span> ex)
        {
            <span class="code-type">MessageBox</span>.Show($<span class="code-string">"Грешка: {ex.Message}"</span>);
        }
    }

    <span class="code-keyword">private void</span> clbTasks_ItemCheck(<span class="code-type">object</span> sender, <span class="code-type">ItemCheckEventArgs</span> e)
    {
        _taskService.ToggleTaskStatus(e.Index);
        BeginInvoke((<span class="code-type">MethodInvoker</span>)<span class="code-keyword">delegate</span> { RefreshTaskList(); });
    }

    <span class="code-keyword">private void</span> RefreshTaskList()
    {
        clbTasks.Items.Clear();
        <span class="code-keyword">var</span> allTasks = _taskService.GetAllTasks();
        <span class="code-keyword">foreach</span> (<span class="code-keyword">var</span> task <span class="code-keyword">in</span> allTasks)
        {
            clbTasks.Items.Add(task.Description, task.IsDone);
        }
    }
}</code></pre>
            </div>
        </section>

        <!-- Part 5 -->
        <section>
             <h2>Част 5: Стартиране и Тест</h2>
             <p class="mb-6">Натиснете <strong>F5</strong> или зеления бутон "Start", за да стартирате приложението.</p>
             <div class="mt-4 p-4 bg-green-100 border-l-4 border-green-500 text-green-800 rounded-md">
                <p><strong class="font-bold">Тествайте:</strong></p>
                <ul class="list-disc list-inside mt-2 text-sm">
                    <li>Опитайте да добавите празна задача. Трябва да видите съобщение за грешка.</li>
                    <li>Добавете няколко валидни задачи. Те трябва да се появят в списъка.</li>
                    <li>Отбележете някоя задача като изпълнена. Тя трябва да остане в списъка, но с отметка.</li>
                </ul>
            </div>
            <div class="mt-8 p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 rounded-md">
                <p><strong class="font-bold">🔥 Бонус предизвикателство (по желание)</strong></p>
                <p class="mt-2 text-sm">Опитайте се да добавите бутон "Изтрий". За целта ще трябва да добавите `DeleteTask` методи в `TaskRepository` и `TaskService` и да ги извикате от формата.</p>
            </div>
        </section>

    </main>

     <footer class="text-center py-6 bg-slate-800 text-slate-400 text-sm mt-16">
        <p>Успех с упражнението!</p>
    </footer>

    <script>
        document.querySelectorAll('.copy-btn').forEach(button => {
            button.addEventListener('click', () => {
                const pre = button.parentElement.querySelector('pre');
                const text = pre.innerText;
                navigator.clipboard.writeText(text).then(() => {
                    button.textContent = 'Копирано!';
                    setTimeout(() => {
                        button.textContent = 'Копирай';
                    }, 2000);
                }).catch(err => {
                    console.error('Неуспешно копиране: ', err);
                });
            });
        });
    </script>
</body>
</html>
